---
layout: default
---

{% include home-header.html %}
{%- assign date_format = site.date_format | default: "%Y-%m-%d" -%}
{% assign posts = paginator.posts | default: site.posts %}

<div class="home-page-header">
  <h1 class="home-page-title">포스트</h1>
  <pre class="home-page-code highlight" aria-label="Random advice (C)"><code id="home-advice-code">printf("%s\n", "Loading...");</code></pre>
</div>

{% if posts and posts != empty %}
<div class="posts">
  {% for post in posts %}
  <section class="post-entry">
    <h2 class="post-title">
      <a href="{{ post.url | relative_url }}">
        {{ post.title | escape }}
      </a>
    </h2>

    <div class="post-meta">
      <span class="post-meta-item post-meta-date">
        <img class="post-meta-icon" src="{{ 'assets/img/calender.png' | relative_url }}" alt="" aria-hidden="true">
        <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: date_format }}</time>
      </span>
      <span class="post-meta-item post-meta-views">
        <img class="post-meta-icon" src="{{ 'assets/img/eye.png' | relative_url }}" alt="" aria-hidden="true">
        <span class="post-meta-label">조회수:</span>
        <span class="post-view-count" data-post-path="{{ post.url | relative_url }}">0</span>
      </span>
      {%- if post.categories and post.categories != empty -%}
        <span class="post-meta-item post-meta-categories">
          <img class="post-meta-icon" src="{{ 'assets/img/category.png' | relative_url }}" alt="" aria-hidden="true">
          <span class="post-meta-label">카테고리:</span>
          <span class="post-meta-categories-list">
            {%- for category in post.categories -%}
              {% assign slugified_category = category | slugify %}
              <a class="post-category" href="{{ '/categories/' | relative_url }}#{{ slugified_category }}">
                <span class="post-category-text">{{ category | escape }}</span>
              </a>
            {%- endfor -%}
          </span>
        </span>
      {%- endif -%}
      {%- if post.tags and post.tags != empty -%}
        <span class="post-meta-item post-meta-tags">
          <img class="post-meta-icon" src="{{ 'assets/img/tag.png' | relative_url }}" alt="" aria-hidden="true">
          <span class="post-meta-label">태그:</span>
          <span class="post-meta-tags-list">
            {%- for tag in post.tags -%}
              {% assign slugified_tag = tag | slugify %}
              <a class="post-tag" href="{{ '/tags/' | relative_url }}#{{ slugified_tag }}">
                <span class="post-tag-text">{{ slugified_tag }}</span>
              </a>
            {%- endfor -%}
          </span>
        </span>
      {%- endif -%}
      {%- if jekyll.environment == "production" and site.disqus -%}
        <a class="comment-count" href="{{ post.url | relative_url }}#disqus_thread">
          <span class="disqus-comment-count" data-disqus-url="{{ post.url | absolute_url }}"></span>
        </a>
      {%- endif -%}
    </div>

    <p>{{ post.excerpt | strip_html }}</p>
  </section>
  {% endfor %}
  {%- if jekyll.environment == "production" and site.disqus -%}
    <script id="dsq-count-scr" src="//{{ site.disqus }}.disqus.com/count.js" async></script>
  {%- endif -%}
</div>
{% else %}
  <div class="message empty-posts">
    아직 작성된 포스트가 없습니다. 곧 업데이트할게요.
  </div>
{% endif %}

<script defer src="https://unpkg.com/kadvice@2.0.2/dist/index.umd.cjs"></script>
<script>
  (function () {
    function escapeCString(value) {
      return String(value ?? "")
        .replaceAll("\\", "\\\\")
        .replaceAll("\"", "\\\"")
        .replaceAll("\r\n", "\\n")
        .replaceAll("\n", "\\n")
        .replaceAll("\r", "\\n");
    }

    function renderAdvice() {
      const codeEl = document.getElementById("home-advice-code");
      if (!codeEl) return;

      const lib = window.kadvice;
      if (!lib || typeof lib.getAdviceFixtures !== "function") return;
      if (typeof lib.KadviceService !== "function") return;

      const advices = [
        ...lib.getAdviceFixtures(),
        { author: "코바", authorProfile: "(학생)", message: "가끔은, 밤하늘의 별을 올려다 보는 것도 좋아.", tag: 3 },
      ];

      const service = new lib.KadviceService(
        advices,
        typeof lib.KadviceStorageService === "function" ? new lib.KadviceStorageService() : {}
      );

      const advice = service.getOne();
      if (!advice) return;

      const author = advice.author ? String(advice.author) : "";
      const authorProfile = advice.authorProfile ? String(advice.authorProfile) : "";
      const message = advice.message ? String(advice.message) : "";

      const suffix =
        author || authorProfile
          ? ` - ${author}${authorProfile ? ` (${authorProfile})` : ""}`
          : "";

      const lines = [
        `printf("%s\\n", "${escapeCString(message + suffix)}");`,
      ];

      codeEl.textContent = lines.join("\n");
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", renderAdvice);
    } else {
      renderAdvice();
    }
  })();
</script>

<script>
  (function () {
    const cache = new Map();

    function normalizePath(path) {
      try {
        const url = new URL(path, window.location.origin);
        return url.pathname + url.search;
      } catch (_) {
        return path;
      }
    }

    function encodePath(path) {
      const trimmed = String(path || "").replace(/^\/+/, "");
      if (!trimmed) return "";
      return trimmed.split("/").map(encodeURIComponent).join("/");
    }

    function fetchCount(path) {
      const normalizedPath = normalizePath(path);
      if (cache.has(normalizedPath)) return cache.get(normalizedPath);

      const endpoint = `https://kovar1523.goatcounter.com/counter/${encodePath(normalizedPath)}.json`;
      const request = fetch(endpoint, { mode: "cors", credentials: "omit" })
        .then((res) => res.json())
        .then((data) => {
          const views = Number.parseInt(data && data.count ? data.count : "0", 10);
          return Number.isFinite(views) ? views : null;
        })
        .catch(() => null);

      cache.set(normalizedPath, request);
      return request;
    }

    function updateViewCounts() {
      const els = document.querySelectorAll(".post-view-count[data-post-path]");
      if (!els.length) return;

      els.forEach((viewEl) => {
        const postPath = viewEl.getAttribute("data-post-path");
        if (!postPath) return;

        fetchCount(postPath).then((views) => {
          viewEl.textContent = views === null ? "-" : views.toLocaleString();
        });
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", updateViewCounts);
    } else {
      updateViewCounts();
    }
  })();
</script>

{% if paginator and paginator.total_pages > 1 %}
<div class="pagination">
  {% if paginator.previous_page %}
    <a class="pagination-item newer" href="{{ paginator.previous_page_path | relative_url }}" aria-label="Previous page">&lt;</a>
  {% else %}
    <span class="pagination-item newer" aria-disabled="true">&lt;</span>
  {% endif %}

  <span class="pagination-page">{{ paginator.page }} / {{ paginator.total_pages }}</span>

  {% if paginator.next_page %}
    <a class="pagination-item older" href="{{ paginator.next_page_path | relative_url }}" aria-label="Next page">&gt;</a>
  {% else %}
    <span class="pagination-item older" aria-disabled="true">&gt;</span>
  {% endif %}
</div>
{% endif %}
